<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Planning des Interventions</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            const spreadsheetId = '1rX8iqOxaW50tFGpVoYLP7sHGOTJbB2j5dIwi-kBA0Vg'; // Lien de votre Google Sheets
            const sheetName = 'Utilisateurs'; // Nom de la feuille
            const range = sheetName + '!A2:D'; // Plage des donnÃ©es (Email, Nom, Role, Mot de passe)
            const apiKey = 'AIzaSyDGGHn1u1XJ74C8S9rGPb-qGszhpFjSU8s'; // Remplacez par votre clÃ© API Google

            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

            $.get(url, function(data) {
                let isAuthenticated = false;
                let userRole = "";

                // VÃ©rifier si l'email et le mot de passe correspondent Ã  un utilisateur dans la feuille
                for (let i = 0; i < data.values.length; i++) {
                    const row = data.values[i];
                    const storedEmail = row[0];  // Email est en colonne A
                    const storedPassword = row[3];  // Mot de passe est en colonne D

                    if (storedEmail === email && storedPassword === password) {
                        isAuthenticated = true;
                        userRole = row[2]; // RÃ©cupÃ©rer le rÃ´le (colonne C)
                        break;
                    }
                }

                // Si l'utilisateur est authentifiÃ©
                if (isAuthenticated) {
                    // Stocker les informations de l'utilisateur dans localStorage
                    localStorage.setItem('userEmail', email);
                    localStorage.setItem('userRole', userRole);

                    alert(`Connexion rÃ©ussie ! RÃ´le: ${userRole}`);
                    
                    // Rediriger en fonction du rÃ´le
                    if (userRole === 'Admin') {
                        window.location.href = 'admin_dashboard.html';
                    } else if (userRole === 'Technicien') {
                        window.location.href = 'technicien_dashboard.html';
                    } else if (userRole === 'OpÃ©rateur') {
                        window.location.href = 'operateur_dashboard.html';
                    }
                } else {
                    alert("Erreur de connexion : Email ou mot de passe incorrect.");
                }
            }).fail(function() {
                alert("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es. Veuillez rÃ©essayer.");
            });
        }
    </script>
</head>
<body>
    <h1>ðŸ“‹ Planning des Interventions - Connexion</h1>
    
    <form id="loginForm" onsubmit="event.preventDefault(); login();">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" autocomplete="email" required><br><br>

        <label for="password">Mot de passe:</label>
        <input type="password" id="password" name="password" autocomplete="current-password" required><br><br>

        <button type="submit">Se connecter</button>
    </form>
</body>
</html>
